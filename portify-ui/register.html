<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - Portify</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <nav class="navbar">
      <div class="logo"><i class="fas fa-rocket"></i> Portify</div>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="login.html">Login</a>
        <a href="register.html" class="active">Register</a>
      </div>
    </nav>

    <div class="container auth-container">
      <div class="auth-card">
        <h2>Create Account</h2>
        <p>Join Portify and build your portfolio</p>

        <form id="register-form">
          <div class="form-group">
            <label for="username">Username *</label>
            <input
              type="text"
              id="username"
              required
              placeholder="Choose a username"
            />
            <div class="error" id="username-error"></div>
            <small>
              Your portfolio will be available at:
              <code id="url-preview">portfolio-view.html?username=</code>
            </small>
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input
              type="email"
              id="email"
              required
              placeholder="Enter your email"
            />
            <div class="error" id="email-error"></div>
          </div>

          <div class="form-group">
            <label for="password">Password *</label>
            <div class="password-input">
              <input
                type="password"
                id="password"
                required
                placeholder="Create a password (min. 6 characters)"
              />
              <button type="button" class="password-toggle">
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <div class="error" id="password-error"></div>
            <small>Password must be at least 6 characters long</small>
          </div>

          <div class="form-group">
            <label for="confirm-password">Confirm Password *</label>
            <div class="password-input">
              <input
                type="password"
                id="confirm-password"
                required
                placeholder="Confirm your password"
              />
              <button type="button" class="password-toggle">
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <div class="error" id="confirm-password-error"></div>
          </div>

          <div class="form-group checkbox-group">
            <input type="checkbox" id="terms" required />
            <label for="terms">
              I agree to the <a href="#">Terms of Service</a> and
              <a href="#">Privacy Policy</a>
            </label>
            <div class="error" id="terms-error"></div>
          </div>

          <button type="submit" class="btn btn-primary btn-block">
            <i class="fas fa-user-plus"></i> Create Account
          </button>
        </form>

        <p class="auth-link">
          Already have an account? <a href="login.html">Login here</a>
        </p>
      </div>
    </div>

    <script>
      // Update URL preview in real-time
      document
        .getElementById("username")
        .addEventListener("input", function () {
          const username = this.value.trim();
          const urlPreview = document.getElementById("url-preview");

          if (username) {
            // Show the correct URL format
            urlPreview.textContent = `portfolio-view.html?username=${username}`;
          } else {
            urlPreview.textContent = "portfolio-view.html?username=username";
          }

          // Validate username format
          const usernameError = document.getElementById("username-error");
          if (username) {
            const usernameRegex = /^[a-zA-Z0-9_]+$/;
            if (!usernameRegex.test(username)) {
              usernameError.textContent =
                "Username can only contain letters, numbers, and underscores";
              usernameError.style.display = "block";
            } else if (username.length < 3) {
              usernameError.textContent =
                "Username must be at least 3 characters";
              usernameError.style.display = "block";
            } else if (username.length > 20) {
              usernameError.textContent =
                "Username cannot exceed 20 characters";
              usernameError.style.display = "block";
            } else {
              usernameError.textContent = "";
              usernameError.style.display = "none";
            }
          } else {
            usernameError.textContent = "";
            usernameError.style.display = "none";
          }
        });

      // Validate email format
      document.getElementById("email").addEventListener("blur", function () {
        const email = this.value.trim();
        const emailError = document.getElementById("email-error");

        if (email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(email)) {
            emailError.textContent = "Please enter a valid email address";
            emailError.style.display = "block";
          } else {
            emailError.textContent = "";
            emailError.style.display = "none";
          }
        } else {
          emailError.textContent = "";
          emailError.style.display = "none";
        }
      });

      // Validate password strength
      document
        .getElementById("password")
        .addEventListener("input", function () {
          const password = this.value;
          const passwordError = document.getElementById("password-error");

          if (password) {
            if (password.length < 6) {
              passwordError.textContent =
                "Password must be at least 6 characters";
              passwordError.style.display = "block";
            } else {
              passwordError.textContent = "";
              passwordError.style.display = "none";
            }
          } else {
            passwordError.textContent = "";
            passwordError.style.display = "none";
          }
        });

      // Validate password confirmation
      document
        .getElementById("confirm-password")
        .addEventListener("input", function () {
          const password = document.getElementById("password").value;
          const confirmPassword = this.value;
          const confirmError = document.getElementById(
            "confirm-password-error",
          );

          if (confirmPassword) {
            if (password !== confirmPassword) {
              confirmError.textContent = "Passwords do not match";
              confirmError.style.display = "block";
            } else {
              confirmError.textContent = "";
              confirmError.style.display = "none";
            }
          } else {
            confirmError.textContent = "";
            confirmError.style.display = "none";
          }
        });

      // Password toggle functionality
      document.querySelectorAll(".password-toggle").forEach((button) => {
        button.addEventListener("click", function () {
          const input = this.parentElement.querySelector("input");
          const icon = this.querySelector("i");

          if (input.type === "password") {
            input.type = "text";
            icon.className = "fas fa-eye-slash";
          } else {
            input.type = "password";
            icon.className = "fas fa-eye";
          }
        });
      });

      // Register form submission
      document
        .getElementById("register-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // Get form values
          const username = document.getElementById("username").value.trim();
          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value;
          const confirmPassword =
            document.getElementById("confirm-password").value;
          const termsAccepted = document.getElementById("terms").checked;

          // Clear all errors
          const errorIds = [
            "username-error",
            "email-error",
            "password-error",
            "confirm-password-error",
            "terms-error",
          ];

          errorIds.forEach((id) => {
            const el = document.getElementById(id);
            el.textContent = "";
            el.style.display = "none";
          });

          // Validate form
          let isValid = true;

          // Username validation
          if (!username) {
            document.getElementById("username-error").textContent =
              "Username is required";
            document.getElementById("username-error").style.display = "block";
            isValid = false;
          } else if (username.length < 3) {
            document.getElementById("username-error").textContent =
              "Username must be at least 3 characters";
            document.getElementById("username-error").style.display = "block";
            isValid = false;
          } else if (username.length > 20) {
            document.getElementById("username-error").textContent =
              "Username cannot exceed 20 characters";
            document.getElementById("username-error").style.display = "block";
            isValid = false;
          } else if (!/^[a-zA-Z0-9_]+$/.test(username)) {
            document.getElementById("username-error").textContent =
              "Username can only contain letters, numbers, and underscores";
            document.getElementById("username-error").style.display = "block";
            isValid = false;
          }

          // Email validation
          if (!email) {
            document.getElementById("email-error").textContent =
              "Email is required";
            document.getElementById("email-error").style.display = "block";
            isValid = false;
          } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            document.getElementById("email-error").textContent =
              "Please enter a valid email address";
            document.getElementById("email-error").style.display = "block";
            isValid = false;
          }

          // Password validation
          if (!password) {
            document.getElementById("password-error").textContent =
              "Password is required";
            document.getElementById("password-error").style.display = "block";
            isValid = false;
          } else if (password.length < 6) {
            document.getElementById("password-error").textContent =
              "Password must be at least 6 characters";
            document.getElementById("password-error").style.display = "block";
            isValid = false;
          }

          // Confirm password validation
          if (!confirmPassword) {
            document.getElementById("confirm-password-error").textContent =
              "Please confirm your password";
            document.getElementById("confirm-password-error").style.display =
              "block";
            isValid = false;
          } else if (password !== confirmPassword) {
            document.getElementById("confirm-password-error").textContent =
              "Passwords do not match";
            document.getElementById("confirm-password-error").style.display =
              "block";
            isValid = false;
          }

          // Terms validation
          if (!termsAccepted) {
            document.getElementById("terms-error").textContent =
              "You must agree to the terms and conditions";
            document.getElementById("terms-error").style.display = "block";
            isValid = false;
          }

          if (!isValid) {
            return;
          }

          // Show loading state
          const submitBtn = document.querySelector(
            '#register-form button[type="submit"]',
          );
          const originalText = submitBtn.innerHTML;
          submitBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
          submitBtn.disabled = true;

          try {
            const response = await fetch(
              "https://backend.my-portify.com/api/auth/register",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ username, email, password }),
              },
            );

            const data = await response.json();

            if (response.ok) {
              // Show success message
              alert("Account created successfully! You can now log in.");

              // Redirect to login page
              window.location.href = "login.html";
            } else {
              // Show error message
              if (data.message.includes("email")) {
                document.getElementById("email-error").textContent =
                  data.message;
                document.getElementById("email-error").style.display = "block";
              } else if (data.message.includes("username")) {
                document.getElementById("username-error").textContent =
                  data.message;
                document.getElementById("username-error").style.display =
                  "block";
              } else {
                document.getElementById("username-error").textContent =
                  data.message || "Registration failed";
                document.getElementById("username-error").style.display =
                  "block";
              }

              // Reset button
              submitBtn.innerHTML = originalText;
              submitBtn.disabled = false;
            }
          } catch (error) {
            console.error("Registration error:", error);
            document.getElementById("username-error").textContent =
              "Error connecting to server. Please try again.";
            document.getElementById("username-error").style.display = "block";

            // Reset button
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
          }
        });

      // Add some CSS for the URL preview
      const style = document.createElement("style");
      style.textContent = `
        code {
          background: #f0f0f0;
          padding: 2px 6px;
          border-radius: 4px;
          font-family: 'Courier New', monospace;
          font-size: 14px;
          color: #333;
        }
        
        .checkbox-group {
          display: flex;
          align-items: flex-start;
          gap: 10px;
          margin: 20px 0;
        }
        
        .checkbox-group input[type="checkbox"] {
          margin-top: 4px;
        }
        
        .checkbox-group label {
          font-size: 14px;
          line-height: 1.4;
        }
        
        .checkbox-group a {
          color: #4a90e2;
          text-decoration: none;
        }
        
        .checkbox-group a:hover {
          text-decoration: underline;
        }
        
        .error {
          color: #dc3545;
          font-size: 14px;
          margin-top: 5px;
          display: none;
        }
      `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
